```{r message=FALSE, warning=FALSE}
# title: "energyUsePerCountyYeartab.Rmd"
# author: "Eric Koski"
# date: "12/13/2019"
#     Copyright (c) 2021 Orebed Analytics LLC under MIT License; see LICENSE.md. 
# 
#     Data files produced by this software are licensed under a Creative Commons 
#     Attribution 4.0 International License; see
#     https://creativecommons.org/licenses/by/4.0/. 

# We share energyUseSummary with energyUsePerCountyYearplot.Rmd. It is already 
# grouped by County and Year. 
# pivot_wider so we have one column per year. 
energyUseSummaryWider <- pivot_wider(ungroup(energyUseSummary),
                                     names_from = Year, 
                                     values_from = MMBTU)

# dput(energyUseSummaryWider, "energyUseSummaryWider1.txt", control = "all")

energyUseSummaryWider <- energyUseSummaryWider %>%
  bind_rows(summarise_all(., ~(if(is.numeric(.)) sum(.) else "Totals"))) %>%
  mutate(sum = rowSums(select(., starts_with("20")))) %>%
  arrange(sum) %>%
  select(-sum)

# dput(energyUseSummaryWider, "energyUseSummaryWider2.txt", control = "all")

# Convert numeric values to character, so we can use "," as a thousands separator. 
for(col in names(energyUseSummaryWider)) {
  if (is.numeric(energyUseSummaryWider[col][[1]])) {
    energyUseSummaryWider <- energyUseSummaryWider %>%
      mutate((!!as.symbol(col)) := formatC(as.integer(round(!!as.symbol(col))), 
                                           big.mark = ","))
  }
}

# Render the table
if (outputFormat == "pdf_document") {
  energyUseSummaryWider %>%
    kable(escape = FALSE, digits = 0, booktabs = TRUE,
          align = c("lrrrrrrr"),
          linesep = c("", "", "", "", "", "",  "", "", "\\midrule"),
          caption = tableCaption( 
            "Annual industrial and agricultural energy use (millions of BTU) by county")) %>%
    kable_styling(bootstrap_options = c("hover", "condensed"),
                  latex_options = c("hold_position"),
                  position = "center",
                  font_size = 10)
}





```
