```{r message=FALSE, warning=FALSE}
# title: "GHGsByCountyYeartabs.Rmd"
# author: "Eric Koski"
# date: "1/3/2020"
#     Copyright (c) 2021 Orebed Analytics LLC under MIT License; see LICENSE.md. 
# 
#     Data files produced by this software are licensed under a Creative Commons 
#     Attribution 4.0 International License; see
#     https://creativecommons.org/licenses/by/4.0/. 

countiesGHGsummaryWider <- ungroup(countiesGHGsummary) %>%
  arrange(Year) %>%
  pivot_wider(names_from = Year, values_from = CO2e100tonnes) %>%
  bind_rows(summarise_all(., ~(if(is.numeric(.)) sum(.) else "Totals"))) %>%
  mutate(sum = rowSums(select(., starts_with("20")))) %>%
  arrange(sum) %>%
  select(-sum)

# Make a copy we can format for display. 
countiesGHGsummaryWidertab <- countiesGHGsummaryWider

# Convert numeric values to character, so we can use "," as a thousands separator. 
for(col in names(countiesGHGsummaryWidertab)) {
  if (is.numeric(countiesGHGsummaryWidertab[col][[1]])) {
    countiesGHGsummaryWidertab <- countiesGHGsummaryWidertab %>%
      mutate((!!as.symbol(col)) := formatC(as.integer(round(!!as.symbol(col))), 
                                           big.mark = ","))
  }
}

if (outputFormat == "pdf_document") {
  countiesGHGsummaryWidertab %>%
    kable(escape = FALSE, digits = 0, booktabs = TRUE,
          align = c("lrrrrrrr"),
          linesep = c("", "", "", "", "", "",  "", "", "\\midrule"),
          caption = tableCaption( 
            "Annual agricultural/industrial CO$_2$-equivalent emissions (metric tons) by county")) %>%
    kable_styling(bootstrap_options = c("hover", "condensed"),
                  latex_options = c("basic"),
                  position = "center",
                  font_size = 11)
} else { # HTML in case we ever use it. 
  countiesGHGsummaryWidertab %>%
    kable(escape = FALSE, digits = 0, booktabs = TRUE,
          align = c("lrrrrrrr"),
          linesep = c("", "", "", "", "", "",  "", "", "\\midrule"),
          caption = tableCaption( 
            "Annual CO2-equivalent greenhouse gas emissions (metric tons) by county")) %>%
    kable_styling(bootstrap_options = c("hover", "condensed"),
                  position = "center",
                  font_size = 10)
}

```